<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>decomposer: src/workflows.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">decomposer
   &#160;<span id="projectnumber">0.0.0.0</span>
   </div>
   <div id="projectbrief">program for object decomposition for additive manufacturing with sla or ffm</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">workflows.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;vtkPolyData.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;vtkSmartPointer.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;vtkNew.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;vtkBoundingBox.h&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;vtkDataSetSurfaceFilter.h&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;vtkFillHolesFilter.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;vtkDataSetSurfaceFilter.h&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="workflows_8hpp.html">workflows.hpp</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="meshWithAttributes_8hpp.html">meshWithAttributes.hpp</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;polyQualityMeasures.hpp&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;VHACD.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lVtkHelper_8hpp.html">lVtkHelper.hpp</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;openGA.hpp&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;mesh3mfWriter.hpp&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;lVhacdHelper.hpp&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// TODO: for debug (mkdir)</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using namespace </span>polyQualityMeasures;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// TODO: prbly not a very well idea.</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">inline</span> std::mutex mtx_vhacd_compute;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// calculate the whole cost for one part</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// functions get only calculated if the cost is != 0</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="workflows_8hpp.html#ac328abc6b08440ef375861d6083c2a52">   37</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="workflows_8hpp.html#ac328abc6b08440ef375861d6083c2a52">calculateCost</a>(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> *meshwa, <a class="code" href="structsCostWeights.html">sCostWeights</a> costs)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// assumption: meshwa is the mesh and the convex hull. Init neededn&#39;t be done, as this is a per cost thing (some fct need some, some other not -&gt; should be made in class of meshwa)</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordtype">double</span> totalCost = 0;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (costs.costRoughness)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        totalCost += roughness(meshwa);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">if</span> (costs.costOverhangArea)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        totalCost += overhangArea(meshwa);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (costs.costSharpness)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        totalCost += sharpness(meshwa);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span> (costs.costGap)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        totalCost += gap(meshwa);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (costs.costConcavity)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        totalCost += concavity(meshwa);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// this ones rubbish if the splitting is already done until printable</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (costs.costFeasibility)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        totalCost += feasibility(meshwa);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (costs.costInterfaceArea)</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        totalCost += interfaceArea(meshwa);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (costs.costQuantity)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        totalCost += quantity(meshwa);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> totalCost;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;std::vector&lt;MeshWithAttributes&gt; computeConvexHulls(VHACD::IVHACD::Parameters params, std::vector&lt;lVtkHelper::VHACD_POINT_TYPE&gt; &amp;vPoints,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                  std::vector&lt;lVtkHelper::VHACD_INDEX_TYPE&gt; &amp;vTriangles)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// lock to avoid strange locking problems from the static mutex in vhacd</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    mtx_vhacd_compute.lock();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// vhacd decompose and copy the objects to the vecMeshwa</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    VHACD::IVHACD *ivhacd = VHACD::CreateVHACD();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    ivhacd-&gt;Compute(&amp;vPoints[0], (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)vPoints.size() / 3,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    (<span class="keyword">const</span> uint32_t *)&amp;vTriangles[0], (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)vTriangles.size() / 3, params);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// do work on ivhacd (copy), so it can be freed and used by others</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">auto</span> nChs = ivhacd-&gt;GetNConvexHulls();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    std::vector&lt;MeshWithAttributes&gt; vecMeshwa;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nChs; i++)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        VHACD::IVHACD::ConvexHull ch;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        ivhacd-&gt;GetConvexHull(i, ch);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> mwa;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordtype">bool</span> chSuccess;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        mwa.convexHull = vtkSmartPointer&lt;vtkPolyData&gt;::New();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        mwa.convexHull = <a class="code" href="lVtkHelper_8hpp.html#a357804f8972ad6899d662b44531bae36">lVtkHelper::convertVHACDCH2Polydata</a>(ch, chSuccess);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// this shouldn&#39;t happen but did so if an empty ch exists just ignore it</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">if</span> (chSuccess == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment">// only add meshes that contain data</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> (mwa.convexHull-&gt;GetNumberOfCells() &gt; 0)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            vecMeshwa.push_back(mwa);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    ivhacd-&gt;Clean();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    ivhacd-&gt;Release();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    mtx_vhacd_compute.unlock();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">return</span> vecMeshwa;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;std::vector&lt;MeshWithAttributes&gt; splitPoly(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> *meshwa, VHACD::IVHACD::Parameters params)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// convert mesh to (flat) vectors of points / indexes</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    vtkSmartPointer&lt;vtkPolyData&gt; poly = meshwa-&gt;mesh;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    std::vector&lt;lVtkHelper::VHACD_POINT_TYPE&gt; vPoints;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    std::vector&lt;lVtkHelper::VHACD_INDEX_TYPE&gt; vTriangles;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    lVtkHelper::convertVtkPolyDataToFlatVectors(poly, vPoints, vTriangles);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    std::vector&lt;MeshWithAttributes&gt; vecMeshwa = computeConvexHulls(params, vPoints, vTriangles);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;thread: &quot;</span> &lt;&lt; std::this_thread::get_id() &lt;&lt; <span class="stringliteral">&quot; nChs: &quot;</span> &lt;&lt; vecMeshwa.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// split the mesh until it is printable and add it to the parts vector if it contains cells</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    std::vector&lt;MeshWithAttributes&gt; outVec;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> mwa : vecMeshwa)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">// copy the attribs</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        mwa.copyWithoutMeshes(*meshwa);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        vtkNew&lt;vtkPolyData&gt; tempPoly;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        tempPoly-&gt;DeepCopy(poly);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        mwa.mesh = tempPoly;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        mwa.<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html#af0b9a6d9a1f4f2ac4e2db98aac2ccf5f">calculatePrintDirFromCh</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        mwa.<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html#ada5adefd5126d1b69d5b5c24256fbc53">cutMeshWithCh</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keyword">auto</span> vecFeasParts = mwa.<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html#a78cf19724e6b9d4a63743cd49f86bb00">cutUntilPrintable</a>();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> part : vecFeasParts)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keywordflow">if</span> (part.mesh-&gt;GetNumberOfCells() &gt; 0)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                outVec.push_back(part);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> outVec;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;std::vector&lt;MeshWithAttributes&gt; splitMeshwa(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> *meshwa, VHACD::IVHACD::Parameters params)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    vtkSmartPointer&lt;vtkPolyData&gt; poly = meshwa-&gt;mesh;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    std::vector&lt;lVtkHelper::VHACD_POINT_TYPE&gt; vPoints;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    std::vector&lt;lVtkHelper::VHACD_INDEX_TYPE&gt; vTriangles;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    lVtkHelper::convertVtkPolyDataToFlatVectors(poly, vPoints, vTriangles);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// std::cout &lt;&lt; &quot;thread: &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; ivhacd is : &quot; &lt;&lt; ivhacd &lt;&lt; &quot; nCells is: &quot; &lt;&lt; poly-&gt;GetNumberOfCells() &lt;&lt; &quot; sharp angles is: &quot; &lt;&lt; meshwa-&gt;sharpCornersAngle &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">auto</span> vecTemp = splitPoly(meshwa, params);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">return</span> vecTemp;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/* target: give some file path some costs and some other config then let it run until finished</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> the gen opt may be in another file (as class) this class may create the initial meshwa*/</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/* #region copied partly from opnega example_so1.cpp */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keywordtype">double</span> calculate_SO_total_fitness(<span class="keyword">const</span> GA_Type::thisChromosomeType &amp;X)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// finalize the cost</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> X.middle_costs.totalCost;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;std::ofstream output_file;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">void</span> SO_report_generation(</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordtype">int</span> generation_number,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">const</span> EA::GenerationType&lt;MySolution, MyMiddleCost&gt; &amp;last_generation,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;best_genes)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    std::cout</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Generation [&quot;</span> &lt;&lt; generation_number &lt;&lt; <span class="stringliteral">&quot;], &quot;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Best=&quot;</span> &lt;&lt; last_generation.best_total_cost &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Average=&quot;</span> &lt;&lt; last_generation.average_cost &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Best genes=(&quot;</span> &lt;&lt; best_genes.to_string() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Exe_time=&quot;</span> &lt;&lt; last_generation.exe_time</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        &lt;&lt; std::endl;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">void</span> printNCells(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> meshwa)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;in lamb &quot;</span> &lt;&lt; meshwa.mesh-&gt;GetNumberOfCells() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// as i was unable to get it to work with an object in the struct i will try with an object containing the data</span></div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="classMyClass.html">  181</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMyClass.html">MyClass</a></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;{</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// size type for indexing</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;MeshWithAttributes&gt;::size_type typeVecSize;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// the optimization weights</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="structsCostWeights.html">sCostWeights</a> _costWeights;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// the mesh to decompose</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> *_meshwa;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// the upper limit for the v-hacd parameters</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">double</span> upperLim = 1;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="structMySolution.html">MySolution</a> bestGenes;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> bestCost;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// unused</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">double</span> minChVol = -1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">double</span> maxChs = -1;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// approximately the current population num in the generation (gets set to 0 on report generation and ++ on eval)</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    uint curPopul = 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="classMyClass.html#acd6a58e2becca9949e560adcc506e9ad">  206</a></span>&#160;    <a class="code" href="classMyClass.html#acd6a58e2becca9949e560adcc506e9ad">MyClass</a>(<span class="keyword">const</span> <a class="code" href="structsCostWeights.html">sCostWeights</a> &amp;costWeights, <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> meshwa) : _meshwa()</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        this-&gt;_costWeights = costWeights;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        this-&gt;_meshwa = <span class="keyword">new</span> <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a>(meshwa);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="classMyClass.html#a7354dda33f634d6f22972c5d9610ded8">  217</a></span>&#160;    <a class="code" href="classMyClass.html#a7354dda33f634d6f22972c5d9610ded8">MyClass</a>(<span class="keyword">const</span> <a class="code" href="classMyClass.html">MyClass</a> &amp;mc)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        this-&gt;_costWeights = mc._costWeights;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keyword">auto</span> mwa = *mc._meshwa;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        this-&gt;_meshwa = <span class="keyword">new</span> <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a>(mwa);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    ~<a class="code" href="classMyClass.html">MyClass</a>() { <span class="keyword">delete</span> this-&gt;_meshwa; }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="classMyClass.html#a2eb9c31787d101a0a67e42902113d5dc">  232</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classMyClass.html#a2eb9c31787d101a0a67e42902113d5dc">init_genes</a>(<a class="code" href="structMySolution.html">MySolution</a> &amp;p, <span class="keyword">const</span> std::function&lt;<span class="keywordtype">double</span>(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keyword">auto</span> rndInRng = [=]()</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        { <span class="keywordflow">return</span> upperLim * rnd01(); };</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="comment">// TODO: find reasonable ranges</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        p.alpha = rndInRng();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        p.beta = rndInRng();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        p.gamma = rndInRng();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        p.maxConcavity = rndInRng();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="classMyClass.html#ab7ffaafc232301d72005e7935607c09c">  251</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classMyClass.html#ab7ffaafc232301d72005e7935607c09c">eval_solution</a>(<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;p, <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> &amp;c)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        VHACD::IVHACD::Parameters params;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        params.m_alpha = p.alpha;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        params.m_beta = p.beta;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        params.m_concavity = p.maxConcavity;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> (this-&gt;minChVol &gt; 0)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            params.m_minVolumePerCH = this-&gt;minChVol;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keyword">auto</span> costs = this-&gt;_costWeights;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> mwa;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        mwa.copyMwa(*this-&gt;_meshwa);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keyword">auto</span> vecMwa = splitMeshwa(&amp;mwa, params);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">// calculate the weighted costs if the cost value is not 0, then add to the middle cost (not summed up cost)</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">for</span> (typeVecSize i = 0; i &lt; vecMwa.size(); i++)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keyword">auto</span> meshwa = &amp;vecMwa.at(i);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">if</span> (costs.costRoughness)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                c.costRoughness += costs.costRoughness * roughness(meshwa);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">if</span> (costs.costOverhangArea)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                c.costOverhangArea += costs.costOverhangArea * overhangArea(meshwa);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keywordflow">if</span> (costs.costSharpness)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                c.costSharpness += costs.costSharpness * sharpness(meshwa);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">if</span> (costs.costGap)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                c.costGap += costs.costGap * gap(meshwa);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span> (costs.costConcavity)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                c.costConcavity += costs.costConcavity * concavity(meshwa);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="comment">// this ones rubbish if the splitting is already done until printable</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">if</span> (costs.costFeasibility)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                c.costFeasibility += costs.costFeasibility * feasibility(meshwa);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="comment">// interface area is positive so a minus is used</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span> (costs.costInterfaceArea)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                c.costInterfaceArea -= costs.costInterfaceArea * interfaceArea(meshwa);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">if</span> (costs.costQuantity)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                c.costQuantity += costs.costQuantity * quantity(meshwa);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="comment">// std::cout &lt;&lt; &quot;parts costs were: &quot; &lt;&lt; c.toString() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        this-&gt;curPopul++;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;thread: &quot;</span> &lt;&lt; std::this_thread::get_id() &lt;&lt; <span class="stringliteral">&quot;[npopul:&quot;</span> + std::to_string(this-&gt;curPopul) + <span class="stringliteral">&quot;]: &quot;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;totalparts costs were: &quot;</span> &lt;&lt; c.toString() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="comment">// calculate the total cost as sum of all middle costs</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        c.calculateTotalCost();</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="structMySolution.html">MySolution</a> mutate(<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X_base, <span class="keyword">const</span> std::function&lt;<span class="keywordtype">double</span>(<span class="keywordtype">void</span>)&gt; &amp;rnd01, <span class="keywordtype">double</span> shrink_scale)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <a class="code" href="structMySolution.html">MySolution</a> X_new;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> mu = 0.2 * shrink_scale; <span class="comment">// mutation radius</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// this is crazy caus it might lock forever</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keyword">auto</span> createNewRand = [=]()</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        { <span class="keywordflow">return</span> mu * fabs(rnd01() - rnd01()); };</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keyword">auto</span> outOfRange = [=](<span class="keyword">auto</span> a)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        { <span class="keywordflow">return</span> a &lt; 0 || a &gt; upperLim; };</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keyword">auto</span> createNewRandInRange = [=]()</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keyword">auto</span> newRand = 0.;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                newRand = createNewRand();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            } <span class="keywordflow">while</span> (outOfRange(newRand));</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">return</span> newRand;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        };</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        X_new = X_base;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        X_new.alpha += createNewRandInRange();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        X_new.beta += createNewRandInRange();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        X_new.gamma += createNewRandInRange();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        X_new.maxConcavity += createNewRandInRange();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">return</span> X_new;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="structMySolution.html">MySolution</a> crossover(<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X1, <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X2, <span class="keyword">const</span> std::function&lt;<span class="keywordtype">double</span>(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="structMySolution.html">MySolution</a> X_new;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keyword">auto</span> crossGene = [=](<span class="keyword">auto</span> geneValX, <span class="keyword">auto</span> geneValY)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keyword">auto</span> r = rnd01();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">return</span> r * geneValX + (1.0 - r) * geneValY;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        };</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        X_new.alpha = crossGene(X1.alpha, X2.alpha);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        X_new.beta = crossGene(X1.beta, X2.beta);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        X_new.gamma = crossGene(X1.gamma, X2.gamma);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        X_new.maxConcavity = crossGene(X1.maxConcavity, X2.maxConcavity);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">return</span> X_new;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">void</span> SO_report_generation(</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordtype">int</span> generation_number,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keyword">const</span> EA::GenerationType&lt;MySolution, MyMiddleCost&gt; &amp;last_generation,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;best_genes)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        this-&gt;curPopul = 0;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        std::cout</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Generation [&quot;</span> &lt;&lt; generation_number &lt;&lt; <span class="stringliteral">&quot;], &quot;</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Best=&quot;</span> &lt;&lt; last_generation.best_total_cost &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Average=&quot;</span> &lt;&lt; last_generation.average_cost &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Best genes=(&quot;</span> &lt;&lt; best_genes.to_string() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Exe_time=&quot;</span> &lt;&lt; last_generation.exe_time</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            &lt;&lt; std::endl;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        this-&gt;bestGenes = best_genes;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        this-&gt;bestCost = last_generation.chromosomes.at(last_generation.best_chromosome_index).middle_costs;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;};</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="workflows_8hpp.html#a54efb11e3b91aa5cfadf304278066e00">  362</a></span>&#160;VHACD::IVHACD::Parameters <a class="code" href="workflows_8hpp.html#a54efb11e3b91aa5cfadf304278066e00">optimizeGA</a>(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> meshwa)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;{</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsCostWeights.html">sCostWeights</a> costw;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    output_file.open(<span class="stringliteral">&quot;./bin/result_so1.txt&quot;</span>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    output_file &lt;&lt; <span class="stringliteral">&quot;step&quot;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;x_best&quot;</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;y_best&quot;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;cost_avg&quot;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;cost_best&quot;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    EA::Chronometer timer;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    timer.tic();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;in ga: &quot;</span> &lt;&lt; meshwa.mesh-&gt;GetNumberOfCells() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keyword">auto</span> lmbb = [meshwa](std::string a)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    { <span class="keywordflow">return</span> printNCells(meshwa); };</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    lmbb(<span class="stringliteral">&quot;kk&quot;</span>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// to keep the poly data one could prbly pass the eval function as part of an obj that contains the poly</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// assign poly data here</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    meshwa.setBuildVolume(vtkBoundingBox(0, 200, 0, 150, 0, 200));</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    costw.costConcavity = .0000001;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    costw.costInterfaceArea = .001;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// costw.costGap = 0;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// costw.costQuantity = 5000;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    costw.costQuantity = 100;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    costw.costSharpness = 50;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;meshwa sharp corners: &quot;</span> &lt;&lt; meshwa.sharpCornersAngle &lt;&lt; endl;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="classMyClass.html">MyClass</a> myObj(costw, meshwa);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;weights: &quot;</span> &lt;&lt; myObj._costWeights.costConcavity &lt;&lt; std::endl;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;my obj exists&quot;</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; sharp cost: &quot;</span> &lt;&lt; myObj._meshwa-&gt;sharpCornersAngle &lt;&lt; std::endl;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">// test a min chv vol optimization reducing thin parts</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordtype">double</span> plens[3];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    meshwa.printerBuildVolume.GetLengths(plens);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keyword">auto</span> minLen = *std::min_element(plens, plens + 3);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// auto minVol = std::pow(minLen, 3)*.5;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keyword">auto</span> minVol = std::pow(minLen, 3) * .3;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    myObj.minChVol = minVol;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">double</span> paBnds[6];</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    meshwa.mesh-&gt;GetBounds(paBnds);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keyword">auto</span> pBbx = vtkBoundingBox(paBnds);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">double</span> paLens[3];</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    pBbx.GetLengths(paLens);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keyword">auto</span> maxPaLen = *std::max_element(paLens, paLens + 3);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    myObj.maxChs = (maxPaLen / minLen) * 4;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// set ga settings</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    GA_Type ga_obj;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    ga_obj.problem_mode = EA::GA_MODE::SOGA;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// vhacd (performance) contains static variables e.g. s_depth which most likely get shared between threads causing undefined behav if multi obj exist. so no use for now ...</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    ga_obj.multi_threading = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// ga_obj.multi_threading=false;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    ga_obj.idle_delay_us = 1; <span class="comment">// switch between threads quickly</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    ga_obj.verbose = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    ga_obj.population = 20;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    ga_obj.generation_max = 1000;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    ga_obj.calculate_SO_total_fitness = calculate_SO_total_fitness;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keyword">auto</span> initGenesFct = [&amp;myObj](<a class="code" href="structMySolution.html">MySolution</a> &amp;p, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    { myObj.<a class="code" href="classMyClass.html#a2eb9c31787d101a0a67e42902113d5dc">init_genes</a>(p, rnd01); };</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    ga_obj.init_genes = initGenesFct;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keyword">auto</span> evalSolutionFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;p, <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> &amp;c)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    { <span class="keywordflow">return</span> myObj.<a class="code" href="classMyClass.html#ab7ffaafc232301d72005e7935607c09c">eval_solution</a>(p, c); };</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    ga_obj.eval_solution = evalSolutionFct;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keyword">auto</span> mutateFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X_base, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01, <span class="keywordtype">double</span> shrink_scale)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    { <span class="keywordflow">return</span> myObj.mutate(X_base, rnd01, shrink_scale); };</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    ga_obj.mutate = mutateFct;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keyword">auto</span> crossoverFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X1, <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X2, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    { <span class="keywordflow">return</span> myObj.crossover(X1, X2, rnd01); };</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ga_obj.crossover = crossoverFct;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">auto</span> reportFct = [&amp;myObj](<span class="keywordtype">int</span> generation_number, <span class="keyword">const</span> EA::GenerationType&lt;MySolution, MyMiddleCost&gt; &amp;last_generation, <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;best_genes)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    { myObj.SO_report_generation(generation_number, last_generation, best_genes); };</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    ga_obj.SO_report_generation = reportFct;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    ga_obj.best_stall_max = 10;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// 20 % elite, if that is 0 but there are more than one species use 1</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// this is needed to avoid segfs from the ga &quot;lib&quot;</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    uint eliteCount = ga_obj.population * .2;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    eliteCount = (eliteCount == 0 &amp;&amp; ga_obj.population &gt; 1) ? 1 : eliteCount;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    ga_obj.elite_count = eliteCount;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    ga_obj.crossover_fraction = 0.7;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    ga_obj.mutation_rate = 0.4;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    ga_obj.solve();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    VHACD::IVHACD::Parameters resParams;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    resParams.m_alpha = myObj.bestGenes.alpha;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    resParams.m_beta = myObj.bestGenes.beta;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// not in performance</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// resParams.m_gamma = myObj.bestGenes.gamma;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    resParams.m_concavity = myObj.bestGenes.maxConcavity;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// retrieve cost here possible</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;The problem is optimized in &quot;</span> &lt;&lt; timer.toc() &lt;&lt; <span class="stringliteral">&quot; seconds.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    output_file.close();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> resParams;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;}</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="workflows_8hpp.html#ad6da65d8f49f9414877360b3c2141aac">  468</a></span>&#160;VHACD::IVHACD::Parameters <a class="code" href="workflows_8hpp.html#a54efb11e3b91aa5cfadf304278066e00">optimizeGA</a>(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">polyQualityMeasures::MeshWithAttributes</a> meshwa, <a class="code" href="structOptimizationSettings.html">OptimizationSettings</a> optSettings, <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> *ptrMidCost)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsCostWeights.html">sCostWeights</a> costw;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    output_file.open(<span class="stringliteral">&quot;./bin/result_so1.txt&quot;</span>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    output_file &lt;&lt; <span class="stringliteral">&quot;step&quot;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;x_best&quot;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;y_best&quot;</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;cost_avg&quot;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;cost_best&quot;</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    EA::Chronometer timer;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    timer.tic();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="classMyClass.html">MyClass</a> myObj(optSettings.costWts, meshwa);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// uses the printers build volume to define the min convex hull volume (optional and added so that small parts get avoided)</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">// test a min chv vol optimization reducing thin parts</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">double</span> plens[3];</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    meshwa.printerBuildVolume.GetLengths(plens);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">auto</span> minLen = *std::min_element(plens, plens + 3);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// auto minVol = std::pow(minLen, 3)*.5;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keyword">auto</span> minVol = std::pow(minLen, 3) * .3;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    myObj.minChVol = minVol;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordtype">double</span> paBnds[6];</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    meshwa.mesh-&gt;GetBounds(paBnds);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keyword">auto</span> pBbx = vtkBoundingBox(paBnds);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">double</span> paLens[3];</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    pBbx.GetLengths(paLens);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keyword">auto</span> maxPaLen = *std::max_element(paLens, paLens + 3);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    myObj.maxChs = (maxPaLen / minLen) * 4;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// TODO: there might be a bug that ga does not create the right amount of population (used 100 but only counted to 70, could also be some other problem like getting results earlier or so or some feature like don&#39;t redo the elite)</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    GA_Type ga_obj = optSettings.gaSettings;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    ga_obj.problem_mode = EA::GA_MODE::SOGA;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// vhacd (performance) contains static variables e.g. s_depth which most likely get shared between threads causing undefined behav if multi obj exist. so no use for now ...</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    ga_obj.multi_threading = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">// ga_obj.multi_threading=false;</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    ga_obj.idle_delay_us = 1; <span class="comment">// switch between threads quickly</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    ga_obj.verbose = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    ga_obj.calculate_SO_total_fitness = calculate_SO_total_fitness;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keyword">auto</span> initGenesFct = [&amp;myObj](<a class="code" href="structMySolution.html">MySolution</a> &amp;p, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    { myObj.<a class="code" href="classMyClass.html#a2eb9c31787d101a0a67e42902113d5dc">init_genes</a>(p, rnd01); };</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    ga_obj.init_genes = initGenesFct;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">auto</span> evalSolutionFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;p, <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> &amp;c)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    { <span class="keywordflow">return</span> myObj.<a class="code" href="classMyClass.html#ab7ffaafc232301d72005e7935607c09c">eval_solution</a>(p, c); };</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    ga_obj.eval_solution = evalSolutionFct;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keyword">auto</span> mutateFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X_base, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01, <span class="keywordtype">double</span> shrink_scale)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    { <span class="keywordflow">return</span> myObj.mutate(X_base, rnd01, shrink_scale); };</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    ga_obj.mutate = mutateFct;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keyword">auto</span> crossoverFct = [&amp;myObj](<span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X1, <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;X2, <span class="keyword">const</span> std::function&lt;double(<span class="keywordtype">void</span>)&gt; &amp;rnd01)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    { <span class="keywordflow">return</span> myObj.crossover(X1, X2, rnd01); };</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    ga_obj.crossover = crossoverFct;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keyword">auto</span> reportFct = [&amp;myObj](<span class="keywordtype">int</span> generation_number, <span class="keyword">const</span> EA::GenerationType&lt;MySolution, MyMiddleCost&gt; &amp;last_generation, <span class="keyword">const</span> <a class="code" href="structMySolution.html">MySolution</a> &amp;best_genes)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    { myObj.SO_report_generation(generation_number, last_generation, best_genes); };</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    ga_obj.SO_report_generation = reportFct;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    ga_obj.best_stall_max = 10;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// 20 % elite, if that is 0 but there are more than one species use 1</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// this is needed to avoid segfs from the ga &quot;lib&quot;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    uint eliteCount = ga_obj.population * .2;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    eliteCount = (eliteCount == 0 &amp;&amp; ga_obj.population &gt; 1) ? 1 : eliteCount;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    ga_obj.elite_count = eliteCount;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    ga_obj.crossover_fraction = 0.7;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    ga_obj.mutation_rate = 0.4;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    ga_obj.solve();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    VHACD::IVHACD::Parameters resParams;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    resParams.m_alpha = myObj.bestGenes.alpha;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    resParams.m_beta = myObj.bestGenes.beta;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// not in performance</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// resParams.m_gamma = myObj.bestGenes.gamma;</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    resParams.m_concavity = myObj.bestGenes.maxConcavity;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">// retrieve cost here possible</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span> (ptrMidCost != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">// copy the values to the input (optional) pointer</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        *ptrMidCost = myObj.bestCost;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;The problem is optimized in &quot;</span> &lt;&lt; timer.toc() &lt;&lt; <span class="stringliteral">&quot; seconds.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    output_file.close();</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">return</span> resParams;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="workflows_8hpp.html#a810d46009be4b9d543224bc89907893d">  568</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="workflows_8hpp.html#a810d46009be4b9d543224bc89907893d">splitMeshwaAndSave2File</a>(<a class="code" href="classpolyQualityMeasures_1_1MeshWithAttributes.html">MeshWithAttributes</a> *meshwa, VHACD::IVHACD::Parameters params, <span class="keyword">const</span> std::string &amp;path, <span class="keyword">const</span> std::string &amp;resPrefix, <span class="keyword">const</span> std::string &amp;hullPrefix, <a class="code" href="structMyMiddleCost.html">MyMiddleCost</a> *thisCost)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;{</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    std::vector&lt;vtkSmartPointer&lt;vtkTransform&gt;&gt; vecPartTransfs;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;vtkSmartPointer&lt;vtkTransform&gt;&gt;::size_type transfIdx;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">auto</span> parts = splitMeshwa(meshwa, params);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    std::vector&lt;vtkSmartPointer&lt;vtkPolyData&gt;&gt;::size_type i = 0;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">// store every subpart and hull as 3mf and vtk in original and transformed rotation</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">for</span> (; i &lt; parts.size(); i++)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keyword">auto</span> part = parts.at(i);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment">// &quot;assembly&quot; / transformation storage -&gt; affine matrix</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keyword">auto</span> partTransf = vtkSmartPointer&lt;vtkTransform&gt;::New();</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        partTransf-&gt;Identity();</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="comment">// object storage</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keyword">auto</span> oriMsh = part.getMeshOriginedRotatedToPrintDir(partTransf);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="comment">//      assembly</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        partTransf-&gt;Inverse();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        vecPartTransfs.push_back(partTransf);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="comment">// not transformed vtk</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keyword">auto</span> flpat = path + resPrefix + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">// not transformed hull vtk</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keyword">auto</span> hullpat = path + hullPrefix + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// transformed vtk</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keyword">auto</span> oriflpat = path + <span class="stringliteral">&quot;ori&quot;</span> + resPrefix + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// transformed 3mf</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keyword">auto</span> ori3mfflpat = path + <span class="stringliteral">&quot;ori&quot;</span> + resPrefix + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;.3mf&quot;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// clean the output mesh (try to close holes and other errors)</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        vtkNew&lt;vtkFillHolesFilter&gt; fillHolesFtlr;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        fillHolesFtlr-&gt;SetHoleSize(100);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        fillHolesFtlr-&gt;SetInputData(oriMsh);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        vtkNew&lt;vtkDataSetSurfaceFilter&gt; surfFltr;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        surfFltr-&gt;SetInputConnection(fillHolesFtlr-&gt;GetOutputPort());</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        surfFltr-&gt;Update();</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        vtkNew&lt;vtkGeometryFilter&gt; geomFltr;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        geomFltr-&gt;SetInputConnection(surfFltr-&gt;GetOutputPort());</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        geomFltr-&gt;Update();</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        vtkSmartPointer&lt;vtkPolyData&gt; cleanOriMsh = geomFltr-&gt;GetOutput();</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        lVtkHelper::writeVtkToVtk(part.mesh, flpat.c_str());</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        lVtkHelper::writeVtkToVtk(part.convexHull, hullpat.c_str());</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        lVtkHelper::writeVtkToVtk(cleanOriMsh, oriflpat.c_str());</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        mesh3mfWriter::writeVtkPolyDataAs3mfModel(cleanOriMsh, ori3mfflpat);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// create the file with the transformation info</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keyword">auto</span> transfPat = path + <span class="stringliteral">&quot;assembly_&quot;</span> + resPrefix + <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    std::string assemblyStr;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">for</span> (transfIdx j = 0; j &lt; vecPartTransfs.size(); j++)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        assemblyStr += <span class="stringliteral">&quot;part: &quot;</span> + std::to_string(j) + <span class="stringliteral">&quot;\n&quot;</span> + <span class="stringliteral">&quot;transformation:\n&quot;</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keyword">auto</span> transf = vecPartTransfs.at(j);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment">// 4x4 matrix</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">// to csv with sep: &quot;,&quot; and linebreak: &quot;;&quot;</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        assemblyStr += lVtkHelper::getStringFromvtk4x4MatrixValues(transf);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    std::ofstream assemblyFile(transfPat);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    assemblyFile &lt;&lt; assemblyStr;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    assemblyFile.close();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;wrote assembly file to: &quot;</span> &lt;&lt; transfPat &lt;&lt; std::endl;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// store vhacd parameters</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keyword">auto</span> vhacdParamsPat = path + <span class="stringliteral">&quot;vhacdparams_&quot;</span> + resPrefix + <span class="stringliteral">&quot;.json&quot;</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    std::ofstream vhacdParamsFile(vhacdParamsPat);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    vhacdParamsFile &lt;&lt; getParametersAsJsonString(params);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    vhacdParamsFile.close();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;wrote vhacd params file to: &quot;</span> &lt;&lt; vhacdParamsPat &lt;&lt; std::endl;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// write the costs to a file if they were given to this func</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span> (thisCost != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keyword">auto</span> costPat = path + <span class="stringliteral">&quot;cost_&quot;</span> + resPrefix + <span class="stringliteral">&quot;.json&quot;</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keyword">auto</span> costJson = thisCost-&gt;toStringJson();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        std::ofstream costFile(costPat);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        costFile &lt;&lt; costJson;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        costFile.close();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;wrote costs to file: &quot;</span> &lt;&lt; costPat &lt;&lt; std::endl;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">/* #endregion copied partly from openga... */</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="astructMyMiddleCost_html"><div class="ttname"><a href="structMyMiddleCost.html">MyMiddleCost</a></div><div class="ttdoc">the middle cost of a solution</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8hpp_source.html#l00139">workflows.hpp:139</a></div></div>
<div class="ttc" id="aclassMyClass_html"><div class="ttname"><a href="classMyClass.html">MyClass</a></div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00181">workflows.cpp:181</a></div></div>
<div class="ttc" id="ameshWithAttributes_8hpp_html"><div class="ttname"><a href="meshWithAttributes_8hpp.html">meshWithAttributes.hpp</a></div><div class="ttdoc">a header only class as data container with some additional functionality. May contain mesh and convex...</div></div>
<div class="ttc" id="astructsCostWeights_html"><div class="ttname"><a href="structsCostWeights.html">sCostWeights</a></div><div class="ttdoc">the weigths for the optimization</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8hpp_source.html#l00030">workflows.hpp:30</a></div></div>
<div class="ttc" id="aworkflows_8hpp_html_ac328abc6b08440ef375861d6083c2a52"><div class="ttname"><a href="workflows_8hpp.html#ac328abc6b08440ef375861d6083c2a52">calculateCost</a></div><div class="ttdeci">double calculateCost(polyQualityMeasures::MeshWithAttributes *meshwa, sCostWeights costs)</div><div class="ttdoc">calculate the costs for a single object</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00037">workflows.cpp:37</a></div></div>
<div class="ttc" id="aworkflows_8hpp_html"><div class="ttname"><a href="workflows_8hpp.html">workflows.hpp</a></div><div class="ttdoc">the whole top level optimization workflows and data structures</div></div>
<div class="ttc" id="aworkflows_8hpp_html_a54efb11e3b91aa5cfadf304278066e00"><div class="ttname"><a href="workflows_8hpp.html#a54efb11e3b91aa5cfadf304278066e00">optimizeGA</a></div><div class="ttdeci">VHACD::IVHACD::Parameters optimizeGA(polyQualityMeasures::MeshWithAttributes meshwa)</div><div class="ttdoc">optimize a decomposition using an ga with some default settings</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00362">workflows.cpp:362</a></div></div>
<div class="ttc" id="alVtkHelper_8hpp_html"><div class="ttname"><a href="lVtkHelper_8hpp.html">lVtkHelper.hpp</a></div><div class="ttdoc">helper functions to convert triangle data form lib3mf to vtk polydata. Also lateron prbly &quot;pure&quot; vtk ...</div></div>
<div class="ttc" id="alVtkHelper_8hpp_html_a357804f8972ad6899d662b44531bae36"><div class="ttname"><a href="lVtkHelper_8hpp.html#a357804f8972ad6899d662b44531bae36">lVtkHelper::convertVHACDCH2Polydata</a></div><div class="ttdeci">vtkSmartPointer&lt; vtkPolyData &gt; convertVHACDCH2Polydata(VHACD::IVHACD::ConvexHull ch)</div><div class="ttdoc">converts a vhacd convex hull to poly data. If the hull is empty successfull gets assigned false,...</div><div class="ttdef"><b>Definition:</b> <a href="lVtkHelper_8hpp_source.html#l00095">lVtkHelper.hpp:95</a></div></div>
<div class="ttc" id="aclasspolyQualityMeasures_1_1MeshWithAttributes_html"><div class="ttname"><a href="classpolyQualityMeasures_1_1MeshWithAttributes.html">polyQualityMeasures::MeshWithAttributes</a></div><div class="ttdef"><b>Definition:</b> <a href="meshWithAttributes_8hpp_source.html#l00056">meshWithAttributes.hpp:56</a></div></div>
<div class="ttc" id="aclassMyClass_html_ab7ffaafc232301d72005e7935607c09c"><div class="ttname"><a href="classMyClass.html#ab7ffaafc232301d72005e7935607c09c">MyClass::eval_solution</a></div><div class="ttdeci">bool eval_solution(const MySolution &amp;p, MyMiddleCost &amp;c)</div><div class="ttdoc">decompose the object and evaluate the result</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00251">workflows.cpp:251</a></div></div>
<div class="ttc" id="aworkflows_8hpp_html_a810d46009be4b9d543224bc89907893d"><div class="ttname"><a href="workflows_8hpp.html#a810d46009be4b9d543224bc89907893d">splitMeshwaAndSave2File</a></div><div class="ttdeci">void splitMeshwaAndSave2File(polyQualityMeasures::MeshWithAttributes *meshwa, VHACD::IVHACD::Parameters params, const std::string &amp;path=&quot;/home/louis/CAD/debugGA/&quot;, const std::string &amp;resPrefix=&quot;result&quot;, const std::string &amp;hullPrefix=&quot;hullResult&quot;, MyMiddleCost *thisCost=nullptr)</div><div class="ttdoc">split object using the given params, then store the results</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00568">workflows.cpp:568</a></div></div>
<div class="ttc" id="astructMySolution_html"><div class="ttname"><a href="structMySolution.html">MySolution</a></div><div class="ttdoc">a solution set / species for the ga</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8hpp_source.html#l00123">workflows.hpp:123</a></div></div>
<div class="ttc" id="aclasspolyQualityMeasures_1_1MeshWithAttributes_html_af0b9a6d9a1f4f2ac4e2db98aac2ccf5f"><div class="ttname"><a href="classpolyQualityMeasures_1_1MeshWithAttributes.html#af0b9a6d9a1f4f2ac4e2db98aac2ccf5f">polyQualityMeasures::MeshWithAttributes::calculatePrintDirFromCh</a></div><div class="ttdeci">void calculatePrintDirFromCh()</div><div class="ttdoc">calculate the normal of the biggest cell of the convex hull as print direction (as described in the p...</div><div class="ttdef"><b>Definition:</b> <a href="meshWithAttributes_8hpp_source.html#l01375">meshWithAttributes.hpp:1375</a></div></div>
<div class="ttc" id="aclassMyClass_html_acd6a58e2becca9949e560adcc506e9ad"><div class="ttname"><a href="classMyClass.html#acd6a58e2becca9949e560adcc506e9ad">MyClass::MyClass</a></div><div class="ttdeci">MyClass(const sCostWeights &amp;costWeights, MeshWithAttributes meshwa)</div><div class="ttdoc">Construct a new My Class object.</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00206">workflows.cpp:206</a></div></div>
<div class="ttc" id="aclassMyClass_html_a2eb9c31787d101a0a67e42902113d5dc"><div class="ttname"><a href="classMyClass.html#a2eb9c31787d101a0a67e42902113d5dc">MyClass::init_genes</a></div><div class="ttdeci">void init_genes(MySolution &amp;p, const std::function&lt; double(void)&gt; &amp;rnd01)</div><div class="ttdoc">initialize the first generation of species</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00232">workflows.cpp:232</a></div></div>
<div class="ttc" id="aclasspolyQualityMeasures_1_1MeshWithAttributes_html_ada5adefd5126d1b69d5b5c24256fbc53"><div class="ttname"><a href="classpolyQualityMeasures_1_1MeshWithAttributes.html#ada5adefd5126d1b69d5b5c24256fbc53">polyQualityMeasures::MeshWithAttributes::cutMeshWithCh</a></div><div class="ttdeci">void cutMeshWithCh()</div><div class="ttdoc">cut this-&gt;mesh by this-&gt;convexHull ! might produce not watertight bodys</div><div class="ttdef"><b>Definition:</b> <a href="meshWithAttributes_8hpp_source.html#l00725">meshWithAttributes.hpp:725</a></div></div>
<div class="ttc" id="aclasspolyQualityMeasures_1_1MeshWithAttributes_html_a78cf19724e6b9d4a63743cd49f86bb00"><div class="ttname"><a href="classpolyQualityMeasures_1_1MeshWithAttributes.html#a78cf19724e6b9d4a63743cd49f86bb00">polyQualityMeasures::MeshWithAttributes::cutUntilPrintable</a></div><div class="ttdeci">std::vector&lt; MeshWithAttributes &gt; cutUntilPrintable()</div><div class="ttdoc">cut this mesh unitl every part does fit in the printers build volume, the part gets oriented to the p...</div><div class="ttdef"><b>Definition:</b> <a href="meshWithAttributes_8hpp_source.html#l01083">meshWithAttributes.hpp:1083</a></div></div>
<div class="ttc" id="astructOptimizationSettings_html"><div class="ttname"><a href="structOptimizationSettings.html">OptimizationSettings</a></div><div class="ttdef"><b>Definition:</b> <a href="workflows_8hpp_source.html#l00145">workflows.hpp:145</a></div></div>
<div class="ttc" id="aclassMyClass_html_a7354dda33f634d6f22972c5d9610ded8"><div class="ttname"><a href="classMyClass.html#a7354dda33f634d6f22972c5d9610ded8">MyClass::MyClass</a></div><div class="ttdeci">MyClass(const MyClass &amp;mc)</div><div class="ttdoc">Construct a new My Class object / copy constructor.</div><div class="ttdef"><b>Definition:</b> <a href="workflows_8cpp_source.html#l00217">workflows.cpp:217</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
